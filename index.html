<style>
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
}

th {
    background: #f2f2f2;
    font-weight: bold;
}
</style>

<input id="search" placeholder="Search..." style="padding:10px;width:100%;margin-top:10px">

<table>
    <thead id="thead"></thead>
    <tbody id="sheetData"></tbody>
</table>

<script>
let items = [];
let headers = [];
let lastSearch = "";

// CSV parser that supports quotes correctly
function parseCSV(text) {
    const rows = [];
    let row = [];
    let cell = "";
    let insideQuotes = false;

    for (let i = 0; i < text.length; i++) {
        const char = text[i];

        if (char === '"' && text[i + 1] === '"') {
            cell += '"';
            i++;
        } else if (char === '"') {
            insideQuotes = !insideQuotes;
        } else if (char === ',' && !insideQuotes) {
            row.push(cell);
            cell = "";
        } else if ((char === '\n' || char === '\r') && !insideQuotes) {
            if (cell || row.length) {
                row.push(cell);
                rows.push(row);
                row = [];
                cell = "";
            }
        } else {
            cell += char;
        }
    }

    if (cell || row.length) {
        row.push(cell);
        rows.push(row);
    }

    return rows;
}

async function loadData() {
    const res = await fetch("https://docs.google.com/spreadsheets/d/1O0H8iVkIk92U0W5HLLJG5pWtGkhPfBD7IysidXc5sYI/export?format=csv");
    const csv = await res.text();

    const rows = parseCSV(csv);

    headers = rows[0];
    items = [];

    for (let i = 1; i < rows.length; i++) {
        if (rows[i].length === 0) continue;

        let obj = {};
        headers.forEach((h, index) => {
            obj[h] = rows[i][index] || "";
        });

        items.push(obj);
    }

    renderTableHeader();
    applyFilter(lastSearch);
}

function renderTableHeader() {
    document.getElementById("thead").innerHTML =
        "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
}

function display(arr) {
    let html = "";

    arr.forEach(row => {
        html += "<tr>";
        headers.forEach(h => {
            html += `<td>${row[h]}</td>`;
        });
        html += "</tr>";
    });

    document.getElementById("sheetData").innerHTML = html;
}

function applyFilter(q) {
    lastSearch = q.toLowerCase();

    let filtered = items.filter(row =>
        Object.values(row).some(v =>
            v.toString().toLowerCase().includes(lastSearch)
        )
    );

    display(filtered);
}

document.getElementById("search").addEventListener("input", function () {
    applyFilter(this.value);
});

// Auto refresh every 10 seconds
setInterval(loadData, 10000);

loadData();
</script>
