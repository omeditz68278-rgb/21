<script>
let items = [];

fetch("https://docs.google.com/spreadsheets/d/1O0H8iVkIk92U0W5HLLJG5pWtGkhPfBD7IysidXc5sYI/export?format=csv")
  .then(res => res.text())
  .then(data => {
      let rows = data.split(/\r?\n/);

      items = [];

      rows.forEach((row, index) => {
          let cols = row.split(",");

          // Skip bad rows or short rows
          if (cols.length < 4 || index === 0) return;

          items.push({
              name: cols[1]?.trim(),
              section: cols[2]?.trim(),
              num: cols[3]?.trim()
          });
      });

      display(items);
  });

function display(arr) {
    let html = "";
    arr.forEach(i => {
        if (!i.name) return; // skip empty rows
        html += `
            <div class='item'>
                <b>${i.name}</b><br>
                Section: ${i.section} | Number: ${i.num}
            </div>
        `;
    });
    document.getElementById("list").innerHTML = html;
}

document.getElementById("search").addEventListener("input", function () {
    let q = this.value.toLowerCase();

    let sorted = [...items].sort((a, b) => {
        let aMatch = a.name.toLowerCase().includes(q);
        let bMatch = b.name.toLowerCase().includes(q);
        return (bMatch ? 1 : 0) - (aMatch ? 1 : 0);
    });

    display(sorted);
});
</script>
