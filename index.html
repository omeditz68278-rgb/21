<style>
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
}

th {
    background: #f2f2f2;
    font-weight: bold;
}
</style>

<input id="search" placeholder="Search..." style="padding:10px;width:100%;margin-top:10px">

<table>
    <thead>
        <tr>
            <th>S.NO</th>
            <th>ITEM NAME</th>
            <th>Section</th>
            <th>Number</th>
        </tr>
    </thead>
    <tbody id="sheetData"></tbody>
</table>

<script>
let items = [];
let lastSearch = "";

async function loadData() {
    try {
        let res = await fetch("https://docs.google.com/spreadsheets/d/1O0H8iVkIk92U0W5HLLJG5pWtGkhPfBD7IysidXc5sYI/export?format=csv");
        let data = await res.text();

        let rows = data.split(/\r?\n/);
        items = [];

        rows.forEach((row, index) => {
            let cols = row.split(",");

            if (index === 0 || cols.length < 4) return;

            items.push({
                sno: cols[0]?.trim(),
                name: cols[1]?.trim(),
                section: cols[2]?.trim(),
                num: cols[3]?.trim()
            });
        });

        applyFilter(lastSearch);
    } catch (e) {
        console.log("Error loading data", e);
    }
}

function display(arr) {
    let html = "";
    arr.forEach(i => {
        html += `
            <tr>
                <td>${i.sno}</td>
                <td>${i.name}</td>
                <td>${i.section}</td>
                <td>${i.num}</td>
            </tr>
        `;
    });
    document.getElementById("sheetData").innerHTML = html;
}

function applyFilter(q) {
    lastSearch = q.toLowerCase();

    let filtered = items.filter(i =>
        i.name.toLowerCase().includes(lastSearch) ||
        i.section.toLowerCase().includes(lastSearch) ||
        i.num.toLowerCase().includes(lastSearch) ||
        i.sno.toLowerCase().includes(lastSearch)
    );

    display(filtered);
}

document.getElementById("search").addEventListener("input", function () {
    applyFilter(this.value);
});

// ðŸ”¥ Auto-refresh every 10 seconds
setInterval(loadData, 10000);

// First load
loadData();
</script>
